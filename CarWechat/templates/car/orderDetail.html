{% extends "base.html" %}
{% block css %}
    <link href="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.css" rel="stylesheet">
    <style type="text/css">
        .container {
            padding: 20px;
        }

        .row {
            margin-top: 1.5rem;
        }

        #count {
            height: 1rem !important;
            border-bottom: none !important;
            margin-left: 10px !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;

        }

        .ui-spinner {
            width: 50% !important;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="container">
        <div class="col s12 m6 l4">

            <div class="card">
                <div class="card-content">
                    <span class="card-title">订单--{{ orderConfig[data.status][0] }} </span>
                    <table class="striped centered">

                        <tbody>
                        <tr>
                            <td>订单编号</td>
                            <td>{{ data.tradeno |cutstring}}</td>
                        <tr>
                            <td>订单时间</td>
                            <td>{{ data.created_at }}</td>
                        </tr>
                        <tr>
                            <td>订单状态</td>
                            <td style="color: {{ orderConfig[data.status][2] }}">{{ orderConfig[data.status][0] }}</td>
                        </tr>
                        <tr>
                            <td>车型</td>
                            <td>{{ data.Cartype.name }}</td>
                        </tr>
                        {#                        <tr>#}
                        {#                            <td>每日租金</td>#}
                        {#                            <td id="price">{{ data.Cartype.price }}</td>#}
                        {#                        </tr>#}
                        <tr>
                            <td>天数</td>
                            <td>{{ data.count }}</td>
                        </tr>
                        <tr>
                            <td>总价/元</td>
                            <td id="sum">{{ data.totalfee/100 }}</td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="row">
                        {% if data.status=="ok" %}
                            <div class="col s6 offset-s3">
                                <a
                                        class="blue lighten-1 waves-effect waves-light btn col s8 offset-s2"
                                        id="refund">退款</a>
                            </div>
                        {% endif %}

                        {#                        <div class="col s6"><a class="red lighten-1 waves-effect waves-light btn col s8 offset-s2"#}
                        {#                                               id="cancel">取消订单</a></div>#}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block script %}
    <script src="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script>
        function refund() {
            $.ajax({
                url: window.location.protocol + "//" + window.location.host + '/wx/api/refundapply/{{ data.id }}',
                type: 'get',
                contentType: false,
                processData: false,
                success: function (data) {
                    if (data['status'] === 'ok') {
                        alert("正在申请退款，如有疑问请联系客服")
                    }
                    else {
                        alert("申请失败，请重试或联系客服")
                    }
                    location.reload()

                }

            })
        }
        $(document).ready(function () {
            $('#refund').click(function () {
                refund();
            })
        });

    </script>

{% endblock %}